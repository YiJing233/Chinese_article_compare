电子科技大学信息与软件工程学院    实 验 报 告    学    号    2017221103022      姓    名       马雪驰          （实验）	课程名称   数据库原理及应用    理论教师       文  军          实验教师       何中海              电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：马雪驰		学号：2017221103022    指导教师：何中海   实验地点：信软楼西303     实验时间：2019.6.14 一、实验名称：图书销售管理系统数据库SQL应用编程 二、实验学时：4 三、实验目的： 针对图书销售管理数据库开发，了解SQL语言DDL、DML、DQL类型语句在数据库操作访问中的应用方法，培养数据库SQL编程访问能力。同时也掌握基本的数据库触发器、存储过程SQL编程方法，培养数据库后端编程能力。本实验完成图书销售管理系统数据库的SQL数据操作访问和后端数据处理功能。 四、实验原理： 1.首先对图书销售管理系统进行数据需求分析,定义组成系统数据结构的实体、实体属性以及实体之间的关系。通过建模设计工具完成系统概念数据模型设计。进一步对图书销售管理数据库进行物理模型设计，给出数据库设计方案。 2.基于数据库设计方案,通过SQL编程执行来完成对数据库的实现操作。在本实验中，使用SQL语句完成对数据库、关系表、索引、视图、触发器、存储过程的创建,并编写SQL语句对数据库表进行数据的增删查改操作，以及利用视图、存储过程、触发器实现业务数据处理。 五、实验内容： 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行SQL编程操作，并完成触发器、存储过程后端编程，具体实验内容如下: （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写存储过程Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对存储过程Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库SQL应用编程操作，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验器材（设备、元器件）： “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤： 1.在数据库服务器中，采用SQL语句执行方式，创建图书销售管理系统数据库booksale。 2.在BookSale数据库中,采用SQL语句执行方式，创建book(图书表)、auther(作者表)、publisher (出版社表)、stock (库存流水表)、customer (客户表)、sale(销售表)，以及各表主键外键的创建，并为给表创建索引。  3.为book、auther、publisher、 customer 表准备样本数据，采用SQL语句执行方式，将样本数据插入到表中。采用SQL语句对book、auther、 publisher、customner表进行数据修改、删除、查询、统计等访问操作。 4.创建视图book auther publisher,该视图查询数据库,输出图书名、作者、出版社以及图书价格等数据。对视图book_view进行数据查询访问操作。 5.编写触发器函数，实现在sale表数据插入时，级联操作stock表，将图书的库存流水进行记录，同时级联更新book表中对应图书的库存数据。 6.创建完触发器函数之后，创建相对应的触发器,实现上一步中提到的功能。 7.测试触发器的功能，准备sale 表的样本数据，并将其插入sale表，插入之后查看stock表是否有对应的更新，并对比插入sale数据前后book中对应数据的修改情况。 8.编写存储过程函数，实现统计某日图书的销售总量以及总金额数据。 9.调用存储过程函数，查看输出结果是否准确实现业务数据处理功能。 八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 1.创建booksale数据库 使用create database booksale_2017221103022;语句进行创建：    创建结果如下：    由此可见，数据库booksale_2017221103022创建成功。 创建各个数据库表以及表中的外键和索引 先创建表： 将上述代码执行，执行结果如下：   执行完后，在数据库中查看新添加的数据库表对象：  得知数据库表对象创建成功。 插入样本数据，并对auther_2017221103022表进行增删改查操作 插入样本数据到数据库中 执行结果如下：   插入数据成功。 查看auther_2017221103022表数据的代码如下： select *from auther_2017221103022; 执行结果如下：   查询成功。  2）接着添加一条数据进去：    接着我们查询一下，结果如下：    结果成功。  3）接下来进行删除操作，以auther_name为基准删除刚插入的数据。 delete from auther_2017221103022 where auther_name='祝晴';       再用select操作后发现成功。   修改一条auther_2017221103022表数据  执行结果   创建视图 实现思路与方法：创建一个视图将多个表关联查询，通过视图实现简单的数据查询。创建完视图之后可用 select 语句来查看视图，用法：select * from 视图名。例如，创建视图 book_au_pub_view 实现图书信息查询，其代码如下；   再进行视图数据查询： select* from book_au_pub_view;  查询结果如下：   视图创建成功。 5.创建触发器函数 创建触发器函数实现在有一条销售数据插入 sale 表时，同时在库存表 stock 中插入图书的库存变化记录，并修改对应图书表 book 的库存数，为后续的创建触发器提供函数方法。代码如下：   接下来创建触发器：  6.测试触发器 在销售表中插入几个样本数据，之后再查看库存表和图书表的数据，观察这两个表中的数据是否发生变化，并且观察数据的变化是否与插入销售表的数据一致。    再查看stock表和book表    很明显，触发器执行成功。 创建存储过程 通过存储过程实现某日图书销售数量和金额统计。     调用存储过程 实现思路与方法：调用上一步的存储过程，观察输出的结果是否与真实情况一致 Select * from countsale()；    九、总结及心得体会： 通过这次实验，我了解了SQL语言DDL、DML、DQL类型语句在数据库操作访问中的应用方法，培养数据库SQL编程访问能力。同时也掌握了基本的数据库触发器、存储过程SQL编程方法，培养数据库后端编程能力。 对本实验过程及方法、手段的改进建议： 无                                                      报告评分：                                          指导教师签字： 
 电子科技大学信息与软件工程学院    实 验 报 告    学    号    2017221103022      姓    名       马雪驰          （实验）	课程名称   数据库原理及应用    理论教师       文  军          实验教师       何中海              电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：马雪驰		学号：2017221103022    指导教师：何中海   实验地点：信软楼西303     实验时间：2019.6.21 一、实验名称：图书销售管理系统数据库安全管理 二、实验学时：4 三、实验目的： 了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理： 1.设计数据存取权限控制模型，对各角色进行不同权限的赋予，保证数据库数据的安全性。 2.使用 SQL 语句进行角色、用户的创建、对角色进行权限赋予、对用户分派角色。 3.使用不同的用户登录时，就拥有了该用户的权限，在对数据库表进行操作的时候就会受到不同程度的制约。 五、实验内容： 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行数据库安全管理，具体实验内容如下: （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库安全管理，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验器材（设备、元器件）： “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤： 1.针对图书销售管理系统，在设计数据存取权限控制模型。 2. 在 pgAdmin4 中 的 BookSale 数 据 库 中 ， 使 用 SQL 语 句 创 建 客 户 （R_Customer）角色、商家（R_Seller）角色。 3.在 pgAdmin4 中，根据第一步设计的数据存取权限控制模型对客户（R_Customer）角色、商家（R_Seller）角色赋予所定义的数据库对象权限。 4.在 pgAdmin4 中，分别创建客户用户 U_Customer、商家用户 U_Seller，并为客户用户分配客户角色，为商家用户分配商家角色。 5.分别以客户用户 U_Customer、商家用户 U_Seller 身份访问图书销售管理数据库，并分别以这两个用户对各数据库表进行操作，以验证是否正确分配了两用户不同的角色权限。  八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 1.创建客户角色和商家角色 使用 SQL 语句进行角色创建，因为客户角色和商家角色都是普通角色，因此除了登录的功能之外其他的高级权限都为 no。代码如下：      2.赋予客户与商家权限 代码如下：    一次性赋予了商家和客户角色的权限成功。  创建客户用户以及商家用户，并将客户的角色和商家角色赋予他们，代码如下：    创建成功。   分别用客户用户和商家用户登录数据库，并对权限进行验证。 首先登录客户用户进行测试。  1）查看book表   结果正确。 删除一条book_2017221103022表数据   可以看出没有权限。成功。 查看auther表   结果正确。 添加一条数据进auther_2017221103022表   权限不够，成功。 查看sale表  权限不够，成功。 接下来登录商家用户进行测试。   查看customer_2017221103022表  执行成功。 插入一条数据到auther_2017221103022中： 接下来查询验证。   可见添加成功。 从stock_2017221103022中删除一条数据  权限不够，成功。  更新sale_2017221103022一条数据   查询验证一下。   成功。  九、总结及心得体会： 通过这次实验，我了解了该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养了数据库管理能力。 对本实验过程及方法、手段的改进建议： 无                                                      报告评分：                                          指导教师签字：