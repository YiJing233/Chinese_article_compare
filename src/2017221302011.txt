电子科技大学信息与软件工程学院    实 验 报 告    学    号    2017221302011      姓    名      孙玉龙           （实验）	课程名称  数据库原理及应用     理论教师       文军            实验教师      何中海               电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：孙玉龙		学号：2017221302011 指导教师：何中海   实验地点：信软楼西303     实验时间：2019.06.14 一、实验名称：图书销售管理系统数据库SQL应用编程、图书销售管理系统数据库安全管理 二、实验学时：8 三、实验目的： 1.针对图书借阅管理数据库开发，掌握DDL、DML、DQL类型SQL语句在数据库操作访问中的应用方法，培养数据库SQL应用编程能力。同时也掌握基本的数据库触发器、存储过程编程方法，培养数据库后端编程能力。本实验还需要培养数据库SQL应用编程的复杂工程问题解决能力。 2.对图书销售管理系统数据库进行系统安全管理。了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理： 1. 图书销售管理系统数据库SQL应用编程 (1)首先对图书销售管理系统进行数据需求分析，定义组成系统数据结构的实体，实体属性以及实体之间的关系。通过建模设计工具完成系统概念数据模型的设计。进一步对图书销售管理系统进行物理模型的设计，给出数据库设计方案。 (2)基于数据库设计方案，通过SQL编程完成对数据库的实现。在本实验中，主要使用SQL语言创建数据库，创建表，创建视图和索引，创建存储过程和触发器，实现对数据的增删查改功能。 2. 图书销售管理系统数据库安全管理 (1)设计数据库存取权限控制模型，对各角色进行不同权限的赋予，保证数据库数据的安全性。 (2)使用SQL语句进行角色用户创建，对角色进行权限赋予，对用户分派角色。 (3)使用不同的用户登陆时，就拥有了改用户的权限，在对数据库表进行操作时就会收到不同程度的制约。 五、实验内容： 1.图书销售管理系统数据库SQL应用编程 （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 2.图书销售管理系统数据库安全管理 （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 六、实验器材（设备、元器件）： 实验PC计算机 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤： 1. 图书销售管理系统数据库SQL应用编程 (1)数据库 CREATE DATABASE Booksale (2)创建表、示图、索引等 创建表：   (3) 插入数据  删除数据： 查找数据：  更新数据：   (4)编写函数Pro_CurrentSale  (5)调用该函数  (6)编写触发器Tri_InsertSale。 编写触发器函数: 建立触发器：  (7)调用该触发器 插入数据： 删除操作： 更新操作： 2. 图书销售管理系统数据库安全管理 (1) 针对图书销售管理系统数据库，设计数据存取权限控制模型。 实现思路：在图书销售管理系统中，客户用户和商家用户至多有insert和update，或者update的权限。 客户用户对在售查看和删除，插入的权限，商家用户对OnSale有插入权限和读权限 客户模型： 商家模型 (2)在数据库BookSale中，使用SQL语句创建客户(R_Customer)角色和商家(R_Seller)角色。 create role R_Customer WITH login nosuperuser nocreatedb nocreaterole noinherit noreplication connection limit -1; create role R_Seler WITH login nosuperuser nocreatedb nocreaterole noinherit noreplication CONNECTION LIMIT -1; 运行结果如图  (3)对角色R_Customre和R_Seller赋予权限。 grant select,update on booklist to R_Customer; grant select,insert,update on orderform to R_Customer;  grant select,insert,delete,update on booklist to R_Seler ; grant select,delete,update on orderform to R_Seler; 查询结果：  (4)创建用户U_Customer和U_Seller，并为客户用户分配客户角色，为商家用户分配商家角色。 create user U_Customer with login connection limit -1 in role R_Customer password '123456';  create user U_Seller with login connection limit -1 in role R_Seler password '123456'; 查询结果如图  (5)分别以U_Customer和U_Seller的身份访问BookSale数据库，并对各数据表进行操作，验证是否分配了改用户的角色的权限。 U_Customer 对表booklist的SELCET权限，orderform的SELECT、UPDATE和INSERT 权限以及由于触发器存在而需要的对Booklist表的UPDATE权限：  INSERT INTO orderform VALUES('10007','孙玉龙','35','雅典娜之剑','电子科技大学','1','2019-6-30'); UPDATE orderform set orderaddress='山东聊城' Where ordernumber='10003' 执行后结果：  U_Seller对表booklist的全操作和对表orderform的SELECT、UPDATE、DELETE操作。 对booklist的完全操作权限： INSERT INTO booklist VALUES('00008','威尔斯','隐身人','100','28'); UPDATE booklist set bookremain='120' WHERE booknumber='00001'; DELETE FROM booklist WHERE booknumber='00004'; SELECT * FROM booklist; 修改结果如图：  对表orderform的SELECT、UPDATE、DELETE操作权限： 操作前：  操作后：  八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 1. 图书销售管理系统数据库SQL应用编程 初始数据插入后表内数据： Booklist:  Orderform  删除数据:’10002’订单  查找数据：孙玉龙的订单  修改数据：10003订单的购买量为3  创建的函数pro_currentsale()调用结果：（运行日期为2019-06-29）  数据库修改前的库存和订单：   插入新的订单INSERT INTO orderform VALUES('10006','张三','50','钢铁是怎样炼成的','四川成都','2','2019-06-29')，触发器触发，booklist改变：  可以看到，张三订购两本《钢铁是怎样炼成的》后，该书库存相应的减少了两本 同样的，采取DELETE和UPDATE操作： DELETE FROM orderform WHERE ordernumber='10001'  可以看到，订单删除（取消后），《数据库系统》库存相应的增加了一本 UPDATE orderform set orderamount='10' WHERE ordernumber='10004'  可以看到，订单数目由3增加到10后，《雅典娜之剑》的库存量减少了七本。 2. 图书销售管理系统数据库安全管理 实验过程截图可知，实验结果正确，实验成功。 九、总结及心得体会： 总的来说，实验最困难的阶段在于一开始的构思设计阶段，好的设计思路和结构能够更容易实现更多的功能。我个人的功能实现就在编码阶段因为表格结构设计的原因出现了难以实现的困难。总体设计的难度要比编码更高一些。 十、对本实验过程及方法、手段的改进建议： 暂无。                                                      报告评分：                                          指导教师签字：