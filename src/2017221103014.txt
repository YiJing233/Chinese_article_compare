电子科技大学信息与软件工程学院    实 验 报 告    学    号2017221103014          姓    名冯世维                  （实验）	课程名称图书销售管理系统       理论教师 文军                  实验教师 何中海                    电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：冯世维		学号：2017221103014        指导教师：何中海、文军   实验地点：信软楼西303     实验时间：2019.06.14、2019.06.21 一、实验名称：图书销售管理系统数据库SQL应用编程及安全管理 二、实验学时：8 三、实验目的： 实验项目1（图书销售管理系统数据库SQL应用编程）目的 	针对图书借阅管理数据库开发，掌握DDL、DML、DQL类型SQL语句在数据库操作访问中的应用方法，培养数据库SQL应用编程能力。同时也掌握基本的数据库触发器、存储过程编程方法,培养数据库后端编程能力。本实验还需要培养数据库SQL应用编程的复杂工程问题解决能力。 实验项目2（图书销售管理系统安全管理）目的 	对图书销售管理系统数据库进行系统安全管理。了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理： 在关系数据库系统中，所有对数据库的访问操作均可通过DBMS执行SQL语句操作来实现。例如，通过执行CREATE TABLE、ALTER TABLE、DROP TABLE语句实现数据库表创建、修改和删除处理。通过执行INSERT、UPDATE、DELETE语句实现数据库表中数据添加、数据修改、数据删除处理。通过执行SELECT语句实现数据库表数据查询处理。在PostgreSQL数据库系统中，可以使用数据库开发工具pgAdmin或psql命令行工具执行SQL语句，实现数据库对象及其数据的操作访问。 在PostgreSQL数据库中，存储过程、触发器和游标都可使用PL/pgSQL编程实现的数据处理。按照PL/pgSQL提供的语句和程序结构，实现数据库后端功能编程处理。可以使用数据库开发工具pgAdmin或psql命令行工具执行PL/pgSQL程序，实现数据库后端功能处理。 五、实验内容： 实验项目1（图书销售管理系统数据库SQL应用编程）实验内容 （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 实验项目2（图书销售管理系统数据库SQL应用编程）实验内容 （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 六、实验器材（设备、元器件）： 装有PostgreSQL 11的PC一台 七、实验步骤： 实验1 1.执行以下语句，创建数据库表booksale，如图1-1所示 								图1-1 结果分析：数据库创建成功。 2.执行下列SQL语句，创建数据库表，并定义完整性约束，如图1-2所示 								图1-2 结果分析：数据库表创建成功且规定约束。 3.执行下面的SQL语句，创建视图，如图1-3所示     图1-3视图  4.执行下面的SQL语句，向创建的表中插入数据，图1-4为插入成功提示图  图1-4插入成功提示图  图1-5作者信息数据图  图1-6书籍信息数据图  图1-7顾客信息数据图  图1-8出版社信息数据图  图1-9销售信息数据图（此处并未插入）   图1-10存货量数据图 5.执行SQL语句，实现数据删除操作 	1）增加一条数据到 publisher 表 SQL 语句：   图1-11增加一条数据到出版社表 	 图1-12插入数据成功 2）删除publisher表中的上述数据 	SQL语句：  图1-13删除数据成功  图1-14删除后的出版社表 6.执行SQL语句，实现数据查找 	查找book表的SQL语句：  图1-15查询book表 7.执行SQL语句，实现数据修改 	修改数据的SQL语句：  	 图1-16修改成功  图1-17修改成功后表中数据显示 8.编写函数Pro_CurrentSale，实现对当日销售量及销售金额进行统计，具体函数声明如下 其中，函数的输入参数为当日的日期  图1-18构建函数结果 9.编写过程语句块，实现对函数Pro_CurentSale的调用，并输出统计的结果 图1-19函数运算结果  10.编写图书销售表insert触发器Tri_InsertSale,实现图书库存数据同步修改处理。具体触发器处理函数和触发器创建SQL语句如下  图1-20触发器函数创建  图1-21触发器创建SQL语句 11.执行以下SQL语句，向sale表中插入销售数据，对触发器程序进行功能验证。  图1-22插入数据  图1-23 插入数据后数据变动 实验2： 针对图书销售管理系统，在设计数据存取权限控制模型。 角色权限表  在 pgAdmin4 中 的 BookSale 数 据 库 中 ， 使 用 SQL 语 句 创 建 客 户 （R_Customer）角色、商家（R_Seller）角色。  创建用户代码如：     图2-1创建角色成功 创建商家角色代码：       图2-2创建商家角色成功  图2-3创建角色结果 在 pgAdmin4 中，根据第一步设计的数据存取权限控制模型对客户 （R_Customer）角色、商家（R_Seller）角色赋予所定义的数据库对象权限。  赋予用户权限代码如：    图2-4赋予成功图 赋予商户权限代码如：         图2-5赋予成功图 在 pgAdmin4 中，分别创建客户用户 U_Customer、商家用户 U_Seller，并 为客户用户分配客户角色，为商家用户分配商家角色。  实现代码如：         图2-6分配角色  图2-7分配角色成功  分别以客户用户 U_Customer、商家用户 U_Seller 身份访问图书销售管理 数据库，并分别以这两个用户对各数据库表进行操作，以验证是否正确分配了两 用户不同的角色权限。 1）：用户登陆后查询book表  图2-8用户查询book表 2）：用户登陆后修改book表 	显示错误，不足权限 3）：商户登陆后查询book表  图2-9商户查询book表 4）：商户插入数据到Author表  图2-10商户插入数据成功 八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 综合以上分析可以得出结论：成功实现了图书销售管理系统数据库SQL应用编程和成功实现了图书销售管理系统安全管理任务。 十、对本实验过程及方法、手段的改进建议： 	实验前的作业锻炼的很好，所以实验时并没有什么压力，主要还是做实验时需要仔细分析和仔细编码，出了错误会比较难去发现。                                                      报告评分：                                          指导教师签字：