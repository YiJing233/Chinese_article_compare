
电 子 科 技 大 学 实   验   报   告  一、实验一：图书销售管理系统数据库SQL应用编程 二、实验室名称：信软楼西303       实验时间：2019.06.15 三、实验目的 针对图书销售管理数据库开发，了解SQL语言DDL、DML、DQL类型语句在数据库操作访问中的应用方法，培养数据库SQL编程访问能力。同时也掌握基本的数据库触发器、存储过程SQL编程方法，培养数据库后端编程能力。本实验完成图书销售管理系统数据库的SQL数据操作访问和后端数据处理功能。 （1）数据库基本操作 SQL（ Structured Query Language,结构化查询语言 ）是一种对关系数据库进行访问的数据操作语言。 SQL主要操作功能：数据库对象创建、修改、删除；数据库表的数据插入、修改、删除、查询、统计；存储过程、触发器、函数等程序执行；数据库权限、角色、用户等管理。 数据定义语言（Data Definition Language，DDL）是SQL语言中用于创建、修改或删除数据库对象的语句。 	CREATE DATABASE - 创建新数据库 	DROP DATABASE C 删除数据库 	ALTER DATABASE - 修改数据库属性  	CREATE TABLE - 创建新表  	ALTER TABLE C 修改数据库表结构 	DROP TABLE - 删除表 	CREATE INDEX - 创建索引 	DROP INDEX - 删除索引 数据操纵语言（Data Manipulation Language，DML）是SQL语言中用于增添、修改、删除数据的语句。 	INSERT - 向数据库表中插入数据  	UPDATE - 更新数据库表中的数据 	DELETE - 从数据库表中删除数据 数据查询语言（Data Query Language，DQL）是SQL语言中用于对数据库进行数据查询的语句。 数据控制语言（Data Control Language，DCL）是用于对数据库对象访问权进行控制的SQL语句。 	GRANT C 授予用户对数据库对象的权限 	DENY C 拒绝授予用户对数据库对象的权限 	REVOKE C 撤消用户对数据库对象的权限 （2）存储过程 	存储过程（Stored Procedure）是一种数据库的对象； 	由一组能完成特定功能的SQL 语句集构成； 	是把经常会被重复使用的SQL语句逻辑块封装起来，经编译后，存储在数据库服务器端； 	当被再次调用时，而不需要再次编译； 	当客户端连接到数据库时，用户通过指定存储过程的名字并给出参数，数据库就可以找到相应的存储过程予以调用。 	不同的数据库系统创建存储过程的语法存在差异； 	许多数据库为创建存储过程和函数提供不同命令； 	如ORACLE、MySQL、SQL SERVER等数据库，使用CREATE PRECEDURE命令创建存储过程，使用CREATE FUNCTION命令创建函数。 PostgreSQL使用CREATE FUNCTION命令创建存储过程。 CREATE [ OR REPLACE ] FUNCTION  name     ( [ [ argmode ] [ argname ] argtype [ { DEFAULT | = } default_expr ] [, ...] ] )     [ RETURNS retype | RETURNS TABLE ( column_name column_type [, ...] ) ] AS $$         //$$用于声明存储过程的实际代码的开始 DECLARE         -- 声明段 BEGIN         --函数体语句 END; $$ LANGUAGE lang_name;  //$$ 表明代码的结束, LANGUAGE后面指明所用的编程语言 使用存储过程的优点：减少网络通信量；执行速度更快；更强的适应性；降低了业务实现与应用程序的耦合；降低了开发的复杂性；保护数据库元信息；增强了数据库的安全性。 使用存储过程的缺点：SQL本身是一种结构化查询语言，而存储过程本质上是过程化的程序；面对复杂的业务逻辑，过程化处理逻辑相对比较复杂；而SQL语言的优势是面向数据查询而非业务逻辑的处理。如果存储过程的参数或返回数据发生变化，一般需要修改存储过程的代码，同时还需要更新主程序调用存储过程的代码。开发调试复杂，由于缺乏支持存储过程的集成开发环境，存储过程的开发调试要比一般程序困难。可移植性差。 （3）触发器 触发器是特殊类型的存储过程，主要由操作事件(INSERT、UPDATE、DELETE) 触发而被自动执行。 触发器可以实现比约束更复杂的数据完整性，经常用于加强数据的完整性约束和业务规则。触发器本身是一个特殊的事务单位。与表相关联：必须定义在表或视图上。自动触发：由执行INSERT、DELETE、UPDATE操作时触发。不能直接调用，也不能传递或接受参数。是事务的一部分：触发器和触发语句作为可在触发器内回滚的单个事务。  触发器执行的次数可分： （1）语句级触发器：由关键字FOR  EACH  STATEMENT声明，在触发器作用的表上执行一条SQL语句时，该触发器只执行一次，即使是修改了零行数据的SQL，也会导致相应的触发器执行。如果都没有被指定，FOR EACH STATEMENT会是默认值。（2）行级触发器：由关键字FOR  EACH  ROW标记的触发器，当触发器作用的表的数据发生变化时，每变化一行就会执行一次触发器。例如，假设学生成绩表有DELETE触发器，当在该表执行DELETE语句删除记录时，如果删除了20条记录，则将导致 DELETE触发器被执行20 次。按触发的时间分为三类： （1）BEFORE触发器：在触发事件之前执行触发器。（2）AFTER触发器：在触发事件之后执行触发器。（3）INSTEAD OF触发器：当触发事件发生后，执行触发器中指定的函数，而不是执行产生触发事件的SQL 语句，从而替代产生触发事件的SQL操作。在表或视图上，对于INSERT、UPDATE 或 DELETE 三种触发事件，每种最多可以定义一个INSTEAD OF 触发器。 CREATE  TRIGGER  触发器名        { BEFORE | AFTER | INSTEAD OF }      ON 表名      [ FOR [ EACH ] { ROW | STATEMENT } ]      EXECUTE PROCEDURE 存储过程名 ( 参数列表 ) ① 指明所定义的触发器名    ② BEFORE | AFTER | INSTEAD OF  指明触发器被触发的时间 ③ ON 表名 指明触发器所依附的表 ④ FOR  EACH  { ROW | STATEMENT }  指明触发器被触发的次数 ⑤ EXECUTE PROCEDURE 存储过程名 ( 参数列表 )  指明触发时所执行的存储过程 创建触发器基本步骤：检查数据库中将要创建的触发器所依附的表或视图是否存在，如果不存在，必须首先创建该表或视图。创建触发器被触发时所要执行的触发器函数，该函数的类型必须是TRINGER型，是触发器的执行函数。但要注意，有些数据库不需要独立定义触发器函数，而是在创建触发器时，定义触发器的过程体。创建触发器，一般需要指明触发器依附的表，触发器被触发执行的时间，触发器是行级触发器还是语句级触发器，触发器执行需要满足的条件。 四、实验原理 在本实验中，使用 SQL 语句完成对数据库、关系表、索引、视图、触发器、存储过程的创建，并编写 SQL 语句对数据库表进行数据的增删查改操作，以及利用视图、存储过程、触发器实现业务数据处理。 五、实验内容 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行SQL编程操作，并完成触发器、存储过程后端编程，具体实验内容如下: （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库SQL应用编程操作，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验设备及环境 “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤 1.	创建 BookSale 数据库 2.	创建各数据库表以及表中主外键和索引 3.	创建视图 4.	插入样本数据并对 publisher 表进行增删查改操作 5.	创建触发器函数 6.	创建触发器 7.	测试触发器 8.	创建存储过程 9.	调用存储过程 八、实验数据及结果分析 创建图书销售管理系统数据库BookSale  图 1- 1创建BookSale 在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象  图 1- 2创建表   图 1- 3创建索引   图 1- 4创建视图 对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 增：  图 1- 5增加author表   图 1- 6增加publish表   图 1- 7增加book表  图 1- 8增加sale表   图 1- 9增加store表 改：   图 1- 10改author表 删：   图 1- 11删除author表 查：   图 1- 12查找author表 编写存储过程Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。   图 1- 13编写存储过程Pro_CurrentSale 编写过程语句块，实现对存储过程Pro_CurrentSale的调用，并输出统计结果。   图 1- 14编写过程语句块 编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。   图 1- 15编写触发器Tri_InsertSale 对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 使用Insert操作之前：  图 1- 16使用Insert操作之前 对sale表进行Insert操作：  图 1- 17对sale表进行Insert操作 触发器出发之后：  图 1- 18触发器出发之后 九、总结及心得体会 通过此次实验熟悉了数据库各SQL语句使用，理解对数据库中各类型数据的存储方法和数据之间的约束关系。 
 电 子 科 技 大 学 实   验   报   告  一、实验二：图书销售管理系统数据库安全管理 二、实验室名称：信软楼西303 	        实验时间：2019.06.21 三、实验目的 了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理 在SQL语言中，数据控制SQL语句是一种可对用户数据访问权进行控制 的操作语句，它可以控制特定用户或角色对数据表、视图、存储过程、 触发器等数据库对象的访问权限 用户要访问数据库，必须先在DBMS中创建其账号，并成为 数据库的用户。此后，用户每次访问数据库，都需要在 DBMS进行身份验证，只有合法用户才能进入系统，访问操 作数据库对象。在DBMS中，为了方便对众多用户及其权限进行管理，通常 将一组具有相同权限的用户定义为角色(Role)。 五、实验内容 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行数据库安全管理，具体实验内容如下: （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库安全管理，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验设备及环境 “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤 1.针对图书销售管理系统，在设计数据存取权限控制模型。  2. 在 pgAdmin4 中 的 BookSale 数 据 库 中 ， 使 用 SQL 语 句 创 建 客 户 （R_Customer）角色、商家（R_Seller）角色。  3.在 pgAdmin4 中，根据第一步设计的数据存取权限控制模型对客户 （R_Customer）角色、商家（R_Seller）角色赋予所定义的数据库对象权限。  4.在 pgAdmin4 中，分别创建客户用户 U_Customer、商家用户 U_Seller，并 为客户用户分配客户角色，为商家用户分配商家角色。  5.分别以客户用户 U_Customer、商家用户 U_Seller 身份访问图书销售管理 数据库，并分别以这两个用户对各数据库表进行操作，以验证是否正确分配了两 用户不同的角色权限。 八、实验数据及结果分析 创建客户角色、商家角色 创建客户角色 创建商家角色 运行结果： 根据设计的数据存取权限控制模型对客户 （R_Customer）角色、商家（R_Seller）角色赋予所定义的数据库对象权限 对客户角色赋予权限 对商家角色赋予权限 运行结果： 创建客户用户 U_Customer、商家用户 U_Seller，并为客户用户分配客户角色，为商家用户分配商家角色 验证 登录客户用户，验证SELECT DELETE INSERT等操作 登录商家用户，验证SELECT INSERT DELETE UPDATE等操作  九、总结及心得体会 通过此次实验理解了数据库中用户与角色的关系以及它们的意义，自己动手熟悉了数据库中角色和用户的相关操作。