电子科技大学信息与软件工程学院    实 验 报 告    学    号     2017221303022     姓    名        陈潇           （实验）	课程名称   数据库原理及运用    理论教师         文军          实验教师        何中海             电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：陈潇		学号：2017221303022   指导教师：文军 实验地点：信软楼西303   实验时间：2019.6.14 一、实验名称：数据库实验 二、实验学时：8学时 三、实验目的： 完成图书销售管理系统的数据库设计。 完成图书销售管理系统数据库的创建与数据访问操作。 完成图书销售管理系统数据库后端编程 完成图书销售管理系统数据库安全管理 四、实验原理： 在数据库应用系统的数据库设计中，我们用实体关系图（E-R图）方法来展示系统概念数据模型和逻辑数据模型，改模型抽象出系统实体和实体关系，在设计系统逻辑数据模型后，针对应用所采用的Postgresql数据库软件系统进行系统物理数据模型设计，本实验使用powerdesigner建模工具提供的功能开展系统概念数据模型、逻辑数据模型、物理数据模型设计，并对所设计的数据库迷行设计进行检验与完善。 在关系数据库系统中，所有对数据库的访问操作均可以通过DBMS执行SQL语句来实现。 在Postgresql中，存储过程、触发器和游标都可以使用PL/pgsql编程实现的数据处理。按照PL/pgsql提供的语句和程序结构，实现数据库后端功能编程处理，可以使用数据库开发工具pgAdmin或psql命令行工具执行PL/pgsql程序，实现数据库后端功能处理。 在Postgresql中，实现数据存取安全模型是确保数据库安全访问的基本手段。在数据安全存取模型中，需要设计数据库的角色、角色的数据库对象操作权限、数据库用户、数据库与用户的角色赋予、以及数据库对象的操作权限集合。根据设计的数据安全存取模型，系统管理员使用数据库管理工具pgAdmin去创建角色，授予系统管理权限和对象从挨揍权限。此外，系统管理员还需要创建用户，并对用户赋予必要的角色，之后，用户就可以对数据库对象进行访问。 五、实验内容： 实验一： 图书销售管理系统数据需求分析。 图书销售管理系统概念数据模型初步设计。 对初步概念数据模型进行拓展，定义多个模型分图。 解决分图模型中的实体冲突、数据冗余、数据共享等问题、 确保概念数据模型的规范性、一致性和完整性，进行数据模型检查与处理。 将系统概念数据模型转换为支持关系数据库的系统逻辑数据模型。 对系统逻辑数据模型进行规范化完善设计。 将系统逻辑数据模型转换为支持Postgresql数据库系统的系统物理数据模型。 对系统物理数据模型进行完善，增加支持系统业务功能的存储过程、触发器、试图、索引等对象设计。 对系统物理数据模型进行检验与完善。 利用建模工具完成本系统数据库设计报告的生成。 实验二： 完成对数据库BookSale的创建数据库表、索引、视图等对象操作，进行数据的增改删查操作，进行试图的查询修改操作。 实验三： 编写存储过程Pro_CurrentSale,实现当日图书销售量及销售金额汇总统计。 编写过程语句块，实现对存储过程Pro_CurrentSale的调用，并输出统计结果。 编写 图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 编写游标程序cur_PressBookList，实现各个出版社图书列表的显示输出处理。 实验四： 在数据库中创建客户（R_Customer）、商家（R_Seller）角色 在数据库中，根据业务规则为客户、商家角色赋予数据库对象权限。 在数据库中，分别创建客户用户U_Customer、商家用户U_Seller 分别为客户用户U_Customer、商家用户U_Seller分配角色 分别以客户用户、商家用户身份访问图书销售管理数据库，检验数据存取权限模型机制的正确性。 六、实验器材（设备、元器件）： Win10操作系统，Postgresql 11，pgAdmin4，Powerdesigner 七、实验步骤： 实验一： 设计系统概念数据模型 设计系统逻辑数据模型 设计系统物理数据模型 检查概念模型正确性 生成数据库 实验二： 创建数据库 将数据录入数据库 创建并使用视图 实验三： 编写存储过程Pro_CurrentSale,实现当日图书销售量及销售金额汇总统计。 编写过程语句块，实现对存储过程Pro_CurrentSale的调用，并输出统计结果。 编写 图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 编写游标程序cur_PressBookList，实现各个出版社图书列表的显示输出处理。 实验四： 在数据库中创建客户（R_Customer）、商家（R_Seller）角色 在数据库中，根据业务规则为客户、商家角色赋予数据库对象权限。 在数据库中，分别创建客户用户U_Customer、商家用户U_Seller 分别为客户用户U_Customer、商家用户U_Seller分配角色 分别以客户用户、商家用户身份访问图书销售管理数据库，检验数据存取权限模型机制的正确性。  八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 实验一： 需求分析：销售系统有购买者与图书两个实体，图书可以使用图书目录寻找，共三个实体，他们的属性分别有姓名、编号、作者等，具体属性见下图数据模型。 设计系统概念数据模型如图  设计系统逻辑数据模型 使用Tools->Generate Logic Data Model命令生成系统逻辑数据模型，经过完善如图  设计系统物理数据模型 使用工具栏中的自动生成物理数据模型功能，自动转化出数据模型如图：  检查概念模型正确性 使用工具栏中的check model工具实现工具审查  修改完善到无错误。  使用powerdesigner生成数据库SQL脚本：  生成结果如图：   实验二： 创建数据库 依照实验一中生成的SQL脚本生成数据库：  创建表格：   插入数据：  查询表结果：     创建并使用视图 我们创建一个查看订单编号、购买者姓名、图书名称的视图，SQL代码如下图： Create view 单人购买记录 as Select 订单.订单编号,购买者.姓名,图书.书名 From 订单 join 购买者 on 订单.身份证号=购买者.身份证号 Join 图书 on 订单.图书编号=图书.图书编号； 查看执行结果： Select * from 单人购买记录;  实验三： 编写存储过程Pro_CurrentSale,实现当日图书销售量和销售金额的统计。  运行结果： 首先我们查看订单记录内容：  然后查看函数返回内容：  编写 图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。  编写游标程序cur_PressBookList，实现各个出版社图书列表的显示输出处理。 Query： Open cur_PressBookList for excute ‘select * from 图书 group by 出版社’ 实验四： 在数据库中创建客户（R_Customer）、商家（R_Seller）角色   在数据库中，根据业务规则为客户、商家角色赋予数据库对象权限。  在数据库中，分别创建客户用户U_Customer、商家用户U_Seller   分别为客户用户U_Customer、商家用户U_Seller分配角色   分别以客户用户、商家用户身份访问图书销售管理数据库，检验数据存取权限模型机制的正确性。  可以发现，权限赋予正常。用户能访问图书表而不能访问订单表，如设定。 九、总结及心得体会： 通过四个实验，对数据库有了更整体系统的认识。 在实验一中，熟悉了powerdesigner工具的使用，对于数据库设计中的系统概要数据模型设计，系统逻辑数据模型设计，系统物理数据模型设计三种设计之间的相似点与区别有了更深的了解，将其转换成SQL语言脚本，有了对数据模型转换成数据库表项更深入的理解。 在实验二中，熟悉了pgAdmin的使用，使用GUI图形界面与query相结合的方式将表建立，插入数据，建立视图并进行检验。 在实验三中，熟悉了PL/pgSQL的语法，对于存储过程、游标、触发器的创建以及应用以及他们的意义有了更深的认识：存储过程用于快速进行数据库访问，触发器用于保证数据的一致性，游标用于快捷存储集合类型的查询结果。 在实验四中，对于角色和用户的相同点和不同点有了更深的认识，可以看到，创造他们的语法是相似的，区别在于USER和ROLE两个字段的不同，在赋予权限等语法上，两者语法类似。 十、对本实验过程及方法、手段的改进建议：                                                      报告评分：                                          指导教师签字：