
电 子 科 技 大 学 实   验   报   告  一、实验一：图书销售管理系统数据库SQL应用编程 二、实验室名称：信软学院楼西306	 实验时间：2019.5.20      三、实验目的 针对图书销售管理数据库开发，了解SQL语言DDL、DML、DQL类型语句在数据库操作访问中的应用方法，培养数据库SQL编程访问能力。同时也掌握基本的数据库触发器、存储过程SQL编程方法，培养数据库后端编程能力。本实验完成图书销售管理系统数据库的SQL数据操作访问和后端数据处理功能。 四、实验原理 数据库数据模型 概念数据模型 主要用来描述世界的概念化结构，它使数据库的设计人员在设计的初始阶段，摆脱计算机系统及 DBMS 的具体技术问题，集中精力分析数据以及数据之间的联系等，与具体的数据管理系统（Database Management System，简称 DBMS）无关。概念数据模型必须换成逻辑数据模型，才能在 DBMS 中实现。 逻辑数据模型 用户从数据库所看到的模型，是具体的 DBMS 所支持的数据模型，如网状数据模型 (Network Data Model)、 层次数据模型 (Hierarchical Data Model) 等等。 此模型既要面向用户，又要面向系统 ，主要用于 数据库管理系统 （DBMS）的实现。 物理数据模型 面向计算机物理表示的模型，描述了数据在储存介质上的组织结构，它不但与具体的 DBMS 有关，而且还与操作系统和硬件有关。每一种逻辑数据模型在实现时都有起对应的物理数据模型。DBMS 为了保证其独立性与可移植性，大部分物理数据模型的实现工作又系统自动完成，而设计者只设计索引、聚集等特殊结构。 存储过程 存储过程和用户自定义函数（UDF）是SQL和过程语句的集合，它存储于数据库服务器并能被SQL接口调用。  触发器 PostgreSQL触发器是一组动作或数据库回调函数，它们在指定的表上执行指定的数据库事件(即，INSERT，UPDATE，DELETE或TRUNCATE语句)时自动运行。 触发器用于验证输入数据，执行业务规则，保持审计跟踪等。  五、实验内容 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行SQL编程操作，并完成触发器、存储过程后端编程，具体实验内容如下: （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库SQL应用编程操作，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验设备及环境 “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤 说明：本节需学生编写内容。学生应针对本实验，给出具体实验步骤内容。 (1)在本次实验中，采用数据库管理软件pgAdmin运行postgreSQL命令，因此首先需要在实验机上运行数据库服务以及pgAdmin软件。  (2)利用powerDesigner，根据题目需要，对图书销售系统进行设计和建模，分别建立概念数据模型、逻辑数据模型以及物理数据模型。 (3)模型建立完成后，根据相关规则将模型转换为SQL语言，并在pgAdmin运行。 (4)编写实验报告。 八、实验数据及结果分析 说明：本节需学生编写内容。学生应按照上述步骤完整给出各个实验内容的具体实践操作展示及过程说明，并体现出解决问题思路、编程方法等设计内涵文字描述。在报告内容中，需要有基本的SQL程序代码、运行操作界面、操作数据等结果内容。 （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （a）创建数据库表 （b）创建视图 （c）创建索引  （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作  （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。  （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。  （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。  （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。  九、总结及心得体会 通过本次实验，掌握了数据库建模的基本步骤和方法，能够从概念模型开始，层层递进，建立起逻辑模型和物理模型，最后生成sql脚本，创建出实验要求的数据库，大大提升了对数据库建模的理解。 在实践中学习了Powerdesigner设计数据库模型的基本操作和使用技巧，例如实体和关系的连接、关系中一对多、多对多的情况，以及逐渐、外键的约束等，通过实际操作，加深了课堂理论知识的熟悉程度。 实验缺乏一定的数据，需要学生自己编写、插入一定数量的数据条目才能验证数据库能否正常工作，对实验效率造成了影响，希望以后的实验中，能够给出一定数量的数据。 
 电 子 科 技 大 学 实   验   报   告  一、实验二：图书销售管理系统数据库安全管理 二、实验室名称：信软学院楼西306  	实验时间：2019.05.27 三、实验目的 了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理 角色 PostgreSQL使用角色的概念管理数据库访问权限。  根据角色自身的设置不同，一个角色可以看做是一个数据库用户，或者一组数据库用户。  角色可以拥有数据库对象(比如表)以及可以把这些对象上的权限赋予其它角色， 以控制谁拥有访问哪些对象的权限。  操作角色的语句： create role db_role1; /*--创建角色*/ drop role db_role1;  /*--删除角色*/   \du  --在命令格式下查看所有角色的命令  角色的权限 一个数据库角色可以有很多权限，这些权限定义了角色和拥有角色的用户可以做的事情。  create role db_role1 LOGIN; --创建具有登录权限的角色db_role1 create role db_role2 SUPERUSER; --创建具有超级用户权限的角色 create role db_role3 CREATEDB; --创建具有创建数据库权限的角色 create role db_role4 CREATEROLE --创建具有创建角色权限的角色 alter role db_role1 nologin nocreatedb; --修改角色取消登录和创建数据库权限  用户 其实用户和角色都是角色，只是用户是具有登录权限的角色。 create user db_user1 password '123'; --创建用户 create role db_user1 password '123' LOGIN;  --同上一句等价 drop user db_user1;   --删除用户 alter user db_user1 password '123456'; --修改密码 alter user db_user1 createdb createrole; --对用户授权  赋予角色控制权限 我们可以使用GRANT 和REVOKE命令赋予用户角色，来控制权限。 create user db_user1; --创建用户1 create user db_user2; --创建用户2 create role db_role1 createdb createrole; --创建角色1 grant db_role1 to db_user1,db_user2; --给用户1,2赋予角色1,两个用户就拥有了创建数据库和创建角色的权限 revoke db_role1 from db_user1; --从用户1移除角色1，用户不在拥有角色1的权限 五、实验内容 使用pgAdmin4数据库管理工具对图书销售管理系统数据库进行数据库安全管理，具体实验内容如下: （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 在实验计算机上，利用pgAdmin4数据库管理工具及SQL语句，完成图书销售管理系统数据库安全管理，同时记录实验过程的步骤、操作、运行结果界面等数据，为撰写实验报告提供素材。 六、实验设备及环境 “数据库原理及应用”实验所涉及的机房硬件设备为pc计算机、服务器以及网络环境，pc计算机与服务器在同一局域网络。 操作系统： Windows7 / Windows XP 管理工具： pgAdmin4 DBMS系统： PostgreSQL 11 七、实验步骤 编写SQL语句，在pgAdmin执行相关语句，创建实验所需的各种角色； 根据业务规则编写权限分配相关SQL语句，并在数据库中执行； 在创建角色的基础上，编写创建用户SQL语句，在数据库中执行； 以不同身份访问数据库，验证权限控制的正确性； 编写实验报告。 八、实验数据及结果分析 数据存取权限控制模型如下：  创建客户（R_Customer）、商家（R_Seller）角色SQL如下：  根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。SQL如下：  在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。SQL如下：  分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。SQL如下：  分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 以客户(U_Customer)身份访问Books表，有权限，得到书本信息；尝试插入信息，没有权限，被拒绝插入信息。如图所示。  以商家(U_Sellrt)身份访问BookType表，有权限，得到书本类型信息，尝试插入信息，有权限，成功插入信息，如图所示。  九、总结及心得体会 通过本次实验，掌握了数据库权限控制的基本方法，在实验中创建了具有不同权限的角色，并将角色的权限通过继承分配给新建的用户，最后，通过不同的用户身份对数据库进行访问，验证了权限分配的正确性。 经过实践，对pgAdmin、psql的使用更为熟悉，能够同时掌握在GUI和命令行模式下进行数据库的设计和实现，大大提升了对postgre数据库的掌握。 认识到事先划分用户权限、建立起权限控制模型的重要性，有利于后续SQL语句编写的准确度，防止遗漏。 实验确实数据库备份和恢复环节，建议以后数据库实验中可加入这两个环节，丰富学生对数据库使用的知识。