电子科技大学信息与软件工程学院    实 验 报 告    学    号2017221103015          姓    名张磊                   （实验）	课程名称图书销售管理系统       理论教师 文军                  实验教师 何中海                    电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：张磊		学号：2017221103015        指导教师：何中海、文军   实验地点：信软楼西303     实验时间：2019.06.14、2019.06.21 一、实验名称：图书销售管理系统数据库SQL应用编程及安全管理 二、实验学时：8 三、实验目的： 实验项目1（图书销售管理系统数据库SQL应用编程）目的 	针对图书借阅管理数据库开发，掌握DDL、DML、DQL类型SQL语句在数据库操作访问中的应用方法，培养数据库SQL应用编程能力。同时也掌握基本的数据库触发器、存储过程编程方法,培养数据库后端编程能力。本实验还需要培养数据库SQL应用编程的复杂工程问题解决能力。 实验项目2（图书销售管理系统安全管理）目的 	对图书销售管理系统数据库进行系统安全管理。了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理： 在关系数据库系统中，所有对数据库的访问操作均可通过DBMS执行SQL语句操作来实现。例如，通过执行CREATE TABLE、ALTER TABLE、DROP TABLE语句实现数据库表创建、修改和删除处理。通过执行INSERT、UPDATE、DELETE语句实现数据库表中数据添加、数据修改、数据删除处理。通过执行SELECT语句实现数据库表数据查询处理。在PostgreSQL数据库系统中，可以使用数据库开发工具pgAdmin或psql命令行工具执行SQL语句，实现数据库对象及其数据的操作访问。 在PostgreSQL数据库中，存储过程、触发器和游标都可使用PL/pgSQL编程实现的数据处理。按照PL/pgSQL提供的语句和程序结构，实现数据库后端功能编程处理。可以使用数据库开发工具pgAdmin或psql命令行工具执行PL/pgSQL程序，实现数据库后端功能处理。 五、实验内容： 实验项目1（图书销售管理系统数据库SQL应用编程）实验内容 （1）图书销售管理系统数据库BookSale创建操作 （2）在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象 （3）对图书销售管理系统数据库表进行数据增、删、查、改SQL操作 （4）编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 （5）编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 （6）编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 （7）对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 实验项目2（图书销售管理系统数据库SQL应用编程）实验内容 （1）针对图书销售管理系统数据库，设计数据存取权限控制模型。 （2）在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 （3）在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 （4）在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 （5）分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 （6）分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 六、实验器材（设备、元器件）： 装有PostgreSQL 11的PC一台 七、实验步骤： 实验1 1.执行以下语句，创建数据库表booksale 2.执行下列SQL语句，创建数据库表，并定义完整性约束 4.执行下面的SQL语句，创建视图 5.执行下面的SQL语句，创建索引对象 6.执行下面的SQL语句，向创建的表中插入数据 7.执行SQL语句，实现数据删除操作 8.执行SQL语句，实现数据查找 9.执行SQL语句，实现数据修改 10.编写函数Pro_CurrentSale，实现对当日销售量及销售金额进行统计，具体函数声明如下 其中，函数的输入参数为当日的日期 11.编写过程语句块，实现对函数Pro_CurentSale的调用，并输出统计的结果 12.编写图书销售表insert触发器Tri_InsertSale,实现图书库存数据同步修改处理。具体触发器处理函数和触发器创建SQL语句如下 13.执行以下SQL语句，向sale表中插入销售数据，对触发器程序进行功能验证。  八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 实验2 1.针对图书销售管理系统数据库，设计数据存取权限控制模型。 	1）设计角色权限表如下 角色权限表 	2）设计数据库存取控制安全模型如下图所示  2.在数据库中，执行下列SQL语句，创建客户（R_Customer）、商家（R_seller）角色 3.根据步骤1中的权限表，执行下列SQL语句，为客户和商家角色赋予数据库对象权限 4.执行下列SQL语句，在数据库中，分别创建客户用户（U_Customer）、和商家用户（U_seller），并为他们分配角色 5.分别以客户用户U_Customer、商家用户U_seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 九、总结及心得体会： 实验1 执行数据库创建语句后结果如图1和图2所示 图1 创建数据库SQL语句执行结果 图2 创建完成后数据库对象界面 从图1和图2可以看出，成功创建了图书销售管理数据库booksale。 执行数据库表创建语句执行后，表对象界面，如图3所示。 图3 数据库表创建完成后表对象界面 从图3可以看出，成功创建了相关的数据库表 创建视图对象语句的执行结果及完成后视图对象界面如图4和图5所示 图4 创建视图对象语句执行结果 图5 创建视图对象完成后视图对象界面 从图4和图5可以看出成功创建了视图对象 创建数据库索引对象语句的执行结果及执行后索引对象界面如图6和图7所示 图6 索引对象创建语句执行结果 图7 索引对象界面 从图6和图7可以看出，成功创建了数据库索引对象 验证数据库表的查询操作，验证结果如图8所示 图8 数据库表查询操作验证结果 从图8可以看出数据库表查询操作正常 验证数据库表更新操作，验证结果如图9所示           图9 数据库表更新操作验证结果 从图9可以看出，数据库表更新操作正常 编写过程语句块对函数Pro_CurrentSale进行调用，输出统计结果。调用过程及输出结果如图10所示       图10 调用函数Pro_CurrentSale输出结果 从图10可以看出成功调用了函数Pro_CurrentSale，输出了当日的销售额和销售量。 对触发器Tri_InsertSale功能进行验证，创建好的触发器对象界面如图11所示。执行插入操作之前，库存表inventory中对应表项信息如图12所示，插入操作完成后，库存表inventory中对应表现信息变为如图13所示。 图11 创建完成后针对sale表的触发器对象界面 图12 执行insert操作之前库存表对应表项信息 图13 执行insert操作之后库存表对应项信息 从图12和图13的对比以及执行的插入语句来看，触发器的功能正常，实现了同步修改库存表的功能。 综合以上实验结果分析可以得出结论：成功实现了图书销售管理数据库系统创建与相关SQL应用编程操作。 实验2 创建客户和商家角色后，角色对象界面如图14所示   图14 客户和商家角色对象界面 为两个角色赋予数据库对象权限后，创建客户用户U_Customer和商家用户U_seller，并分别为他们分配R_Customer和R_seller角色，赋予初始密码为“123456”。创建完成后，用户对象界面如图15所示         图15 客户用户和商家用户对象界面 以客户用户U_Customer身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。首先以用户U_Customer身份创建一个服务器，输入主机地址为本机，服务器名称为U_Customer，输入用户名为U_Customer，输入用户U_Customer的密码。创建界面以及创建完成后的服务器对象界面如图16和图17所示       图16 创建服务器界面 图17 服务器对象界面 接着访问图书销售管理数据库，验证用户U_Customer的权限，部分验证结果如图18-2所示 所示图18 验证客户用户是否具有数据库创建权限 从上图可以看出客户用户不具备创建数据库的权限   图19 验证客户用户是否具有角色创建权限 从上图可以看出客户用户不具备创建数据库角色的权限 图20 验证客户用户对authorrank表的查询权限 从上图中可以看出用户对表authorrank不具备查询权限         图21 验证客户用户对数据库表author的查询权限 从图21可以看出，查询语句成功返回了查询结果，说明客户用户对作者表具有查询权限 其它客户用户的权限的验证过程同上，在此不再赘述。接下来以商家用户的身份创建服务器，验证商家用户的数据库存取控制权限。部分验证结果如图22-26所示     图22 以商家用户身份创建服务器界面  图23 创建完成后服务器对象界面   图24 验证商家用户创建数据库的权限 从图24可以看出，商家用户创建数据库的请求被拒绝，说明商家用户不具备创建数据库的权限 图25 验证商家用户创建数据库角色的权限 从图25可以看出，商家用户创建数据库角色的请求被拒绝，说明商家用户不具备创建数据库角色的权限。 图26 验证商家用户对数据库折扣表的插入数据权限 从图26可以看出，返回了成功信息，说明商家用户对折扣表具有相应的插入数据权限 综合以上分析可以得出结论：成功实现了图书销售管理系统安全管理任务。 十、对本实验过程及方法、手段的改进建议： 	实验时可否在大型机上面进行相关的实验，提供创建好的数据库，直接在该数据库上进行响应的操作，另外可以尝试进行数据库嵌入式编程相关方面的实验，可以更贴近实际工程应用。                                                      报告评分：                                          指导教师签字：