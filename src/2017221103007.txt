电子科技大学信息与软件工程学院    实 验 报 告    学    号  2017221103007       姓    名     祝李吉           （实验）	课程名称 数据库原理及应用     理论教师      文军            实验教师     何中海               电子科技大学教务处制表    电 子 科 技 大 学 实   验   报   告 学生姓名：祝李吉		学号：2017221103007    指导教师：何中海   实验地点：信软学院楼西303        实验时间：2019年6月14日 一、实验名称：图书销售管理系统数据库SQL应用编程 二、实验学时：5学时 三、实验目的： 针对图书借阅管理数据库开发，掌握DDL、DML、DQL类型SQL语句在数据库操作访问中的应用方法，培养数据库SQL应用编程能力。同时也掌握基本的数据库触发器、存储过程编程方法，培养数据库后端编程能力。本实验还需要培养数据库SQL应用编程的复杂工程问题解决能力。 四、实验原理： 在关系数据库系统中，所有对数据库的访问操作均可通过DBMS执行SQL语句操作来实现。例如，通过执行CREATE TABLE、ALTER TABLE、DROP TABLE语句实现数据库表创建、修改和删除处理。通过执行INSERT、UPDATE、DELETE语句实现数据库表中数据添加、数据修改、数据删除处理。通过执行SELECT语句实现数据库表数据查询处理。在PostgreSQL数据库系统中，可以使用数据库开发工具pgAdmin或psql命令行工具执行SQL语句，实现数据库对象及其数据的操作访问。 在PostgreSQL数据库中，存储过程、触发器和游标都可使用PL/pgSQL编程实现的数据处理。按照PL/pgSQL提供的语句和程序结构，实现数据库后端功能编程处理。可以使用数据库开发工具pgAdmin或psql命令行工具执行PL/pgSQL程序，实现数据库后端功能处理。 五、实验内容： 图书销售管理系统数据库BookSale创建操作。 在图书销售管理系统数据库BookSale中创建数据库表、视图、索引等对象。 对图书销售管理系统数据库表进行数据增、删、查、改SQL操作。 编写函数Pro_CurrentSale，实现当日图书销售量及销售金额汇总统计。 编写过程语句块，实现对函数Pro_CurrentSale的调用，并输出统计结果。 编写图书销售表Insert触发器Tri_InsertSale，实现图书库存数据同步修改处理。 对图书销售表Insert触发器Tri_InsertSale程序进行功能验证。 六、实验器材（设备、元器件）： 实验PC计算机 七、实验步骤： 创建数据库BookSale。 SQL语句：CREATE DATABASE BookSale; 执行结果如图1-1所示： 图1-1 创建数据库结果图 创建数据库表，包括作者、图书、出版社、图书类别、销售、库存、商店、折扣。 作者SQL语句： 出版社SQL语句： 图书SQL语句： 图书类别SQL语句： 折扣SQL语句：  库存SQL语句： 商店SQL语句： 销售SQL语句：  执行结果如图1-2所示： 图1-2 创建表执行结果图 为每个表插入数据。 作者SQL语句： 商店SQL语句： 折扣SQL语句： 出版社SQL语句： 图书类别SQL语句： 图书SQL语句： 库存SQL语句：    销售SQL语句： 创建图书数据表的视图。 SQL语句： 执行结果如图1-3所示： 图1-3 创建视图执行结果图 为图书数据表的书名创建索引。 SQL语句： CREATE INDEX BookName_Idx ON Books (BookName); 执行结果如图1-4所示：   图1-4 创建索引执行结果图 对作者数据表进行增加操作。 SQL语句：INSERT INTO Writer VALUES('000000000011','张磊','北京市','13822344231'); 增加前数据如图1-5所示： 图1-5 增加数据前的数据图 增加后数据如图1-6所示： 图1-6 增加数据后的数据图   对作者数据表进行删除操作。 SQL语句：DELETE FROM Writer    WHERE WriterName='张磊' 执行结果如图1-7所示： 图1-7 删除数据后的数据图 对图书数据表和图书类别数据表进行查询操作。 SQL语句： 语句说明： 查找图书类别为小说的书名和作者。 执行结果如图1-8所示： 图1-8 查询操作执行结果图 对作者数据表进行更改操作。 SQL语句： 执行结果如图1-9所示： 图1-9 更改操作执行结果图 编写Pro_CurrentSale,实现当日图书销售量及销售金额汇总统计。 SQL语句： 编写过程语句块，实现对函数Pro_CurrentSale的调用 SQL语句：SELECT pro_currentsale() 执行结果如图1-10所示： 图1-10 函数调用结果图 编写图书销售表Inser触发器Tri_InsertSale,实现图书库存数据同步修改处理。 触发器的执行函数SQL语句： 触发器SQL语句： 对图书销售表Inser触发器Tri_InsertSale程序进行功能验证。 Insert SQL语句：INSERT INTO Sell VALUES('21','0000000000000000000001', '000000000001','2019-06-15','4','64') 执行Insert语句前的库存表如图1-11所示： 图1-11 执行Insert语句前的库存表 执行Insert语句后的库存表如图1-12所示： 图1-12 执行Insert语句后的库存表 八、实验结果与分析（含重要数据结果分析或核心代码流程分析） Pro_CurrentSale函数： 函数说明： 通过返回record记录型变量，实现输出每个书店当日的销售量和销售金额，其中用到了SETOF和RETURN NEXT用于输出查询到的多个记录值。在函数主体，用了一个for循环，实现对书店名的遍历，在每个循环中，通过SELECT INTO 语句进行赋值，以及SUM()函数进行求和，再通过JOIN…ON…语句将销售表和书店表连接，用于对当前书店进行统计，对时间的表示用到了CURRENT_DATE函数返回当前时间值。 Tri_InsertSale触发器执行函数和触发器创建： 函数说明： 在触发器执行函数中，通过一个更新语句以及NEW特殊变量，实现对库存量的修改，创建触发器时，主要需要注意AFTER INSERT语句，即触发器在INSERT语句执行之后触发。 九、总结及心得体会： 在本次实验中，通过对图书销售管理系统数据库的开发，创建数据库，创建表，插入数据，再编写函数和触发器一系列过程，掌握了DDL、DML、DQL类型SQL语句在数据库操作访问中的应用方法，同时也掌握了基本的数据库触发器、存储过程编程方法。 在实验期间，遇到的问题有很多。在创建表时，对于有外键依赖属性的表，应先创建其所依赖的表，否则会引起创建错误，在插入数据时也是类似问题，需先插入那些不含外键的表的数据，这些细节问题，看似很小，实则对数据库的影响很大。编写函数时，最初对record记录型变量使用不熟悉，不知如何返回多条记录，通过查询，用了SETOF语句才实现。对for语句的使用也不熟悉，刚开始忘书写END LOOP语句导致了多次错误。在编写代码时，也一定要注意缩进，否则会引起逻辑错误。最后一定要标记出语言，否则会编写错误。在编写触发器时，触发器执行函数的返回类型一定时触发器，否则会导致错误，以及熟悉对特殊变量的使用。 通过本次实验，对数据库的使用更加熟练，对许多命令的结构与细节更加熟悉，也发现了自己比较多的薄弱环节，特别是在存储过程的编写上，对很多数据类型和语法还不是很熟悉。 十、对本实验过程及方法、手段的改进建议： 在编写存储过程时，可以实现输出每个书店每本书的销量与销售额，不仅可以输出当日的统计数据，还可以指定一个输入参数，输出特定日期的统计数据，丰富其功能。                                                      报告评分：                                          指导教师签字： 
 电 子 科 技 大 学 实   验   报   告 学生姓名：祝李吉		学号：2017221103007    指导教师：何中海   实验地点：信软学院楼西303        实验时间：2019年6月21日 一、实验名称：图书销售管理系统数据库安全管理 二、实验学时：3学时 三、实验目的： 对图书销售管理系统数据库进行系统安全管理。了解该DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理、权限管理的基本方法，培养数据库管理能力。在图书销售管理系统数据库中，创建必要的角色和用户，并完成上述角色与用户的权限管理。 四、实验原理： 在PostgreSQL数据库系统中，实现数据存取安全模型是确保数据库安全访问的基本手段。在数据安全存取模型中，需要设计数据库的角色、角色的数据库对象操作权限、数据库用户、数据库用户的角色赋予，以及数据库对象的操作权限集合。根据设计的数据安全存取模型，系统管理员使用数据库管理工pgAdmin去创建角色，授予系统管理权限和对象操作权限。此外，还需要创建用户，并对用户赋予必要的角色。之后，用户就可以对数据库对象进行访问。 五、实验内容： 在PostgreSQL数据库系统软件环境中，实现图书销售数据库BookSale的安全管理。针对图书销售管理，设计数据存取安全模型，分别采用管理工具操作或SQL程序方式实现该数据库的角色、权限、用户安全管理，具体实验内容如下： 针对图书销售管理系统数据库，设计数据存取权限控制模型。 在数据库中，创建客户（R_Customer）、商家（R_Seller）角色。 在数据库中，根据业务规则为客户（R_Customer）、商家（R_Seller）角色赋予数据库对象权限。 在数据库中，分别创建客户用户U_Customer、商家用户U_Seller。 分别为客户用户U_Customer、商家用户U_Seller分派客户（R_Client）、商家（R_Seller）角色。 分别以客户用户U_Customer、商家用户U_Seller身份访问图书销售管理数据库，验证所实现数据存取权限控制模型的正确性。 六、实验器材（设备、元器件）： 实验PC计算机 七、实验步骤： 设计数据存取权限控制模型。 图2-1 客户角色权限模型 图2-2 商家角色权限模型 创建客户(R_Customer)、商家(R_Seller)角色。 SQL语句： 执行结果如图2-3所示： 图2-3 创建角色执行结果图 根据业务规则，为两个角色赋予权。 SQL语句： 执行部分结果如图2-4，2-5所示： 图2-4 R_Customer对图书类别表的权限 图2-5 R_Seller对图书表的权限 创建客户用户U_Customer，商家用户U_Seller，并分别为他们分派客户R_Customer和商家R_Seller角色。 SQL语句： 执行结果如图2-6所示： 图2-6 创建用户执行结果图 以客户U_Customer身份访问图书销售管理数据库。 登录过程如图2-7所示： 图2-7 登录过程图 以客户U_Customer身份对Writer表进行读操作。 SQL语句：SELECT * FROM WRITER 执行结果如图2-8所示：  图2-8 对Writer表进行读操作结果图 以客户U_Customer身份对Sell表进行读操作。 SQL语句：SELECT * FROM Sell 执行结果如图2-9所示： 图2-9 对Sell表进行读操作结果图 以客户U_Customer身份对Writer表进行删除操作。 SQL语句：DELETE FROM Writer     WHERE WriterName='小王' 执行结果如图2-10所示： 图2-10 对Writer表进行删除操作结果图 以客户U_Customer身份对Writer表进行更改操作。 SQL语句： 执行结果如图2-11所示： 图2-11 对Writer表进行更改操作结果图 以客户U_Customer身份对Writer表进行插入操作。 SQL语句：INSERT INTO Writer VALUES('000000000007','张磊','成都市电子科技大学','18113104968') 执行结果如图2-12所示： 图2-12 对Writer表进行插入操作结果图 以客户U_Seller身份访问图书销售管理数据库。 登录过程如图2-13所示： 图2-13 登录过程图 以客户U_Seller身份对Writer表进行读操作。 SQL语句：SELECT * FROM Writer 执行结果如图2-14所示： 图2-14 对Writer表进行读结果图 以客户U_Seller身份对Writer表进行更改操作。 SQL语句： 执行结果如图2-15所示： 图2-15 对Writer表进行更改结果图 以客户U_Seller身份对Writer表进行删除操作。 SQL语句：DELETE FROM Writer      WHERE WriterName='小王' 执行结果如图2-16所示： 图2-16 对Writer表进行删除操作结果图 以客户U_Seller身份对Writer表进行插入操作。 SQL语句：INSERT INTO Writer VALUES('000000000004','小王','成都市成华区','13880029856') 执行结果如图2-17所示： 图2-17 对Writer表进行插入结果图 以客户U_Seller身份对Publish表进行读操作。 SQL语句：SELECT * FROM Publish 执行结果如图2-18所示： 图2-18 对Publish表进行读结果图 以客户U_Seller身份对Publish表进行删除操作。 SQL语句：DELETE FROM Publish     WHERE PublishName='译林' 执行结果如图2-19所示： 图2-19 对Publish表进行删除结果图 以客户U_Seller身份对Publish表进行更改操作。 SQL语句： 执行结果如图2-20所示： 图2-20 对Publish表进行更改结果图 以客户U_Seller身份对Publish表进行插入操作。 SQL语句：INSERT INTO Publish VALUES('000000000004','西南交大','88724824','成都市') 执行结果如图2-21所示： 图2-21 对Publish表进行插入结果图  八、实验结果与分析（含重要数据结果分析或核心代码流程分析） 当以U_Customer登录访问数据库时，由于对Writer表只有读取权限，所以在对Writer表执行删除、插入、更改操作时，会提示permission denied for table Writer。由于对销售表没有任何权限，所以进行读操作也会提示permission denied for table Writer。 当以U_Seller登录访问数据库时，由于对对Writer表拥有读取、删除、更改、插入权限，所以4个访问操作等能成功，而对于Publish表只有读取权限，所以在对Publish表进行更改、删除、插入操作会提示permission denied for table Publish。验证了所实现数据存取权限控制模型为正确的。 九、总结及心得体会： 在这次实验中，通过创建客户和商家两个角色，并进行授权，分别以两个角色的用户对数据库进行访问操作，了解了DBMS系统对数据库管理的内容与方法，特别是理解数据库安全机制和作用，以及PostgreSQL数据库角色管理、用户管理权限管理的基本方法。 由于此次实验涉及的逻辑问题并不强，主要是对于几个命令的熟悉和使用，所以基本没遇到什么问题，只需要注重语法格式即可。 通过两次实验，熟悉了数据库的基本操作，也掌握了许多命令，对课堂上学习的理论知识有很大提高。 十、对本实验过程及方法、手段的改进建议： 暂无。                                                      报告评分：                                          指导教师签字： 